<!DOCTYPE html>
<html lang="english">
<head>
        <meta charset="utf-8" />
        <title>Salientia Stuff - clustering</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Salientia Stuff </a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/category/data-science.html">Data Science</a></li>
                    <li><a href="/category/word-of-the-week.html">Word of the Week</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/k-means-clustering-part-1.html">K-Means Clustering Part 1</a></h1>
<footer class="post-info">
        <abbr class="published" title="2018-02-18T18:00:00-07:00">
                Published: Sun 18 February 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/yannick.html">Yannick</a>
        </address>
<p>In <a href="/category/data-science.html">Data Science</a>.</p>
<p>tags: <a href="/tag/clustering.html">clustering</a> <a href="/tag/k-means.html">k-means</a> </p>
</footer><!-- /.post-info --><h2>Just Another Review of K-Means</h2>
<p>K-means clustering is a well-known algorithm for which there already exist many good online resources. My first introduction to K-means (as was the case with many other machine learning techniques) was from the textbook <a href="http://www-bcf.usc.edu/~gareth/ISL/"><em>Introduction to Statistical Learning</em></a>. However, a recent experience caused me to revisit this algorithm. After discussing K-means with someone who held some misconceptions about the algorithm, I decided to dig deeper into some of the details. Though I doubt those misconceptions are widely held, I wanted to address a few of them. Looking more closely at the algorithm, I learned a few new things as well -- in particular, the different initialization techniques. Instead of focusing on a few isolated aspects of K-means, it seemed more natural to wrap them together into a general discussion of the algorithm. And that's how another review of K-means clustering was born.  I wish I could say that I'm presenting K-means from an exciting new point of view that will completely redefine the way you think about the algorithm. But the truth is I mostly just had fun making some plots and wanted to share the results.</p>
<p>I decided to split the discussion into several posts. In this first post, we'll talk about why one might use K-means clustering, discuss how to choose the number of clusters, and then give a brief overview of the algorithm. In the second part, we'll discuss different initialization techniques and the importance of running the algorithm several times with different random initializations. Then, in a third post, we'll look a little more closely at the math behind K-means and look at some data that causes trouble for K-means.</p>
<p>The figures in this post were generated using Matplotib. All of the code can be found in <a href="https://github.com/yvanhuele/yvanhuele.github.io/blob/extra-blog-materials/K-Means/K-Means%20Clustering.ipynb">this jupyter notebook</a>.</p>
<h2>K-Means at a Glance</h2>
<p>K-means clustering is an unsupervised learning algorithm which separates data into K distinct groups. As with many other unsupervised methods, the goal is to discover hidden structure within the data. In particular, K-means tries to separate data points into groups where the points in a group are closer to each other than to points in other groups.</p>
<p>In low dimensional data (2 or 3 variables), we might be able to directly identify structure by plotting the data. For higher dimensional data, this cannot often be done nicely. Furthermore, even when we can identify structure in data by plotting it, we often want to describe the structure in a way that we can make further use of it.</p>
<p>For example, in the plot below, we can see that the points cluster nicely into four distinct blobs, but if we want to make use of this clustering, we need a criterion for determining which points are part of each cluster.</p>
<p align="center"><img alt="Four well-separated clusters of points" src="/images/k-means/four_blobs.png" style="max-width:100%" /></p>
<p>We might start by noting that the points in the top-left cluster are distinguished from the rest by the property that <span class="math">\(x &lt; 0\)</span> and <span class="math">\(y &gt; 6\)</span>. Similar methods work for the bottom-right cluster, but the <span class="math">\(x\)</span>- and <span class="math">\(y\)</span>-coordinates of the two other clusters overlap.</p>
<p>Thus, we turn to unsupervised learning techniques such as K-means clustering to discover structure in our data.</p>
<h2>An Application</h2>
<p>A common application of clustering techniques is <a href="https://en.wikipedia.org/wiki/Market_segmentation">market segmentation</a>. If an online shopping site has access to information about its customers such as browsing history, purchasing history, age, geographic location, it can be useful to separate its customer base into different subgroups. The purpose of clustering can simply be descriptive â€” to get an idea of the customer base. For example, suppose the site's customers are predominantly either college students in New England or retirees in Arizona. Looking at the average customer over the whole data set is not very helpful since, in reality, the site has few middle aged customers from Missouri. On the other hand, if the site's customers are first split into two subgroups, the average attributes of each subgroup would be more enligtening. Clustering can also be used to help in supervised learning problems. The site is unlikely to have a huge amount of purchasing data for every single one of its customers. By grouping together similar customers, the site can leverage a lot more data to determine which products a given customer is likely to buy and can target its advertisements accordingly.</p>
<p>Some other applications of K-means are listed <a href="https://en.wikipedia.org/wiki/K-means_clustering#Applications">here</a>.</p>
<h2>An Example: Handwritten Digits</h2>
<p>We're going to illustrate the power of K-means through a toy problem, by looking at images of handwritten digits. Specifically, we'll work with the test set of the <a href="http://archive.ics.uci.edu/ml/datasets/optical+recognition+of+handwritten+digits">UCI ML Optical Recognition of Handwritten Digits Data Set</a> which is included in the <a href="http://scikit-learn.org/stable/datasets/index.html">scikit-learn datasets package</a>. This data set consists of 1797 samples, each corresponding to the pixel intensities of an 8 by 8 pixel grayscale image of a handwritten digit. A few example images are shown below (reconstructed from 8x8 numeric arrays of pixel intensities):</p>
<p align="center"><img alt="Examples of handwritten digits from the dataset" src="/images/k-means/example_digits.png" style="max-width:100%" /></p>
<p><strong>Toy Problem:</strong> <em>Separate the digits into 3 groups of digits having similar shapes (or, more precisely, similar pixel intensity values).</em></p>
<p>We already have a good system for separating these digits into 10 classes (i.e., by digit), but it's not quite as clear how to separate them into just 3 classes. To try and solve this problem, we can apply K-means clustering with <span class="math">\(K = 3\)</span>, and look at some of the digits that made it into each cluster.</p>
<p align="center"><img alt="Digits separated into three clusters" src="/images/k-means/digit_clusters.png" style="max-width:100%" /></p>
<p>Without knowing anything about digits, the algorithm has nonetheless picked up on similarities. For example, the last cluster seems to contain most of the 0s, 4s, and 6s.</p>
<p>For a more rigorous analysis, consider the following table which records how many instances of each digit made it into each cluster.</p>
<div class="math">$$
\begin{array}{r|rrrrrrrrrr}
 &amp; 0 &amp; 1 &amp; 2 &amp; 3 &amp; 4 &amp; 5 &amp; 6 &amp; 7 &amp; 8 &amp; 9 \\ \hline
1 &amp; 2 &amp; 38 &amp; 161 &amp; 167 &amp; 0 &amp; 72 &amp; 1 &amp; 0 &amp; 65 &amp; 146 \\
2 &amp; 0 &amp; 140 &amp; 16 &amp; 16 &amp; 55 &amp; 97 &amp; 1 &amp; 179 &amp; 108 &amp; 34 \\
3 &amp; 176 &amp; 4 &amp; 0 &amp; 0 &amp; 126 &amp; 13 &amp; 179 &amp; 0 &amp; 1 &amp; 0 \\
\end{array}
$$</div>
<p>We see that cluster 1 contains most of the 2s, 3s, and 9s, that cluster 2 contains most of the 1s and 7s, and cluster 3 contains most of the 0s, 4s, and 6s and that the 5s and 8s are mostly split between clusters 1 and 2. Another way to see how the clusters split up the data is to use <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">principal component analysis</a> (PCA), a method for representing high-dimensional data in 2-dimensions in such a way as to preserve as much spread as possible.</p>
<p align="center"><img alt="Clustered digits plotted with the first 2 principal components" src="/images/k-means/digits_pca.png" style="max-width:100%" /></p>
<h2>Restrictions</h2>
<p>K-means clustering cannot be applied to all data sets, and even when it can be applied, it may not give great results:</p>
<ul>
<li>First, the <strong>data must be numerical</strong>: we need to be able to compute distances between data points and to average data points. There are alternative clustering methods that can deal with categorical or mixed data types, such as K-modes or K-medoids with the <a href="https://stats.stackexchange.com/a/15313">Gower metric</a>.</li>
<li><strong>The number of clusters K must be set in advance.</strong> That is, K-means clustering cannot pick the number of clusters for you. We'll talk about this more in the next section.</li>
<li>The goal of K-means is to minimize the distances between points in the same cluster. This captures a specific type of structure, but fails to capture other patterns, and <strong>there are numerical data sets that are not well-suited to K-means</strong>. We'll discuss this in more detail in a later blog post.</li>
</ul>
<h2>What is K?</h2>
<p>The number of clusters, K, is a hyperparameter that must be set in advance. Often, K is chosen using domain expertise. You can also often get an idea for the number of clusters through plotting and data exploration.</p>
<p>Let's explore this further using a real-world data set: <a href="https://en.wikipedia.org/wiki/Iris_flower_data_set">Fisher's Iris dataset</a>. The Iris data set one of many included in <a href="http://scikit-learn.org/stable/datasets/index.html">scikit-learn's datasets package</a>. The Iris data set contains 150 sets of measurements for 3 different species of Iris (50 samples from each species)</p>
<p>One way to examine the data by plotting each variable against every other variable using a <a href="https://seaborn.pydata.org/generated/seaborn.pairplot.html">pairplot</a> from the seaborn library.</p>
<p align="center"><img alt="Pair plot of Iris data without species labels" src="/images/k-means/iris_pairplot_unlabeled.png" style="max-width:100%" /></p>
<p>Looking at these plots, we do indeed see some underlying structure. The five pair plots along with the histogram for petal length separate the data into two distinct groups. Recall though that there should be 3 different species of iris represented. What's going on?</p>
<p>Since we have the luxury of knowing the individual labels (i.e. which iris species each point corresponds to), let's go ahead a look at these plots again after incorporating this information.</p>
<p align="center"><img alt="Pair plot of Iris data with species labels" src="/images/k-means/iris_pairplot_labeled.png" style="max-width:100%" /></p>
<p>We see that the data do indeed cluster into three groups, but that two of those just barely overlap.</p>
<p>Another way of plotting high dimensional data is to use a dimensionality reduction technique such as PCA.  Below, the Iris data set is plotted using the first two principal components.</p>
<p align="center"><img alt="Iris data plotted using 2 principal components" src="/images/k-means/iris_PCA.png" style="max-width:100%" /></p>
<p>So, by exploring the data through visualizations and by using domain expertise, we have come up with two reasonable values of K, namely:</p>
<ul>
<li><span class="math">\(K = 2\)</span> seems most natural based on the various plots of the data.</li>
<li><span class="math">\(K = 3\)</span> would be an obvious choice if you knew that the data set contained specimens from three different species, but didn't have the species labels included in the data.</li>
</ul>
<p>The results of performing K-means clustering with <span class="math">\(K = 2\)</span> and <span class="math">\(K = 3\)</span> are presented below.</p>
<p align="center"><img alt="K-means clustering on Iris data with K = 2 and K = 3" src="/images/k-means/iris_clustering.png" style="max-width:100%" /></p>
<p>Note that neither one of these solutions perfectly separates the data (either into the 3 distinct species or into setosa/non-setosa), but they come pretty close. </p>
<p>In the absence of domain-expertise, there are a <a href="https://en.wikipedia.org/wiki/Determining_the_number_of_clusters_in_a_data_set">variety of methods</a> one can use to select the number of clusters.</p>
<h2>A Look at the Algorithm</h2>
<blockquote>
<p><em>For a fine algorithm that gleans<br />
Hidden groupings: two, four, maybe teens<br />
Build centroid and label<br />
Keep up 'til it's stable<br />
That's a very rough draft of K-means</em></p>
</blockquote>
<p>K-means clustering is performed by iterating two steps:</p>
<ol>
<li>Use the cluster labels to recompute the <a href="https://en.wikipedia.org/wiki/Centroid">cluster centroids</a> (geometric centers).</li>
<li>Use the cluster centroids to recompute the cluster labels.</li>
</ol>
<p>Each iteration of these steps reduces the within-cluster variation (i.e. readjusts the clusters so that they're more compact) and, eventually, the clusters will settle down to a stable configuration: neither the labels nor the centroids will change. A few steps of this process are illustrated in the figure below (using <span class="math">\(K = 4\)</span>):
Let's wrap up this section with small warning: the number of clusters is an optional parameter in the scikit-learn <a href="http://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html">KMeans</a> function. However, this implementation is not cleverly selecting the number of clusters based on properties of the data. Instead it's just using the fixed default value of 8 clusters.</p>
<p align="center"><img alt="a few clustering steps" src="/images/k-means/clustering_process.png" style="max-width:100%" /></p>
<p>On the far left, we start with cluster labels (represented by the colors) which we use to compute the centroids in the second figure which are denoted by stars. This illustrates step 1. Now, notice that the labels don't seem well matched to the centroids: for example, the blue point near (0, 5) is much closer to the red centroid than the blue one.</p>
<p>So, going from the second figure to the third, we apply step 2 and relabel each data point so that it matches the nearest centroid. Now the labels give us better looking clusters, but the old centroids are no longer centrally located. The orange star in the third figure is too far to the right; the blue star is too low. We can fix this by applying step 1 again to get the figure on the far right.</p>
<p>In this example, further repetition of these steps won't change anything: we've achieved a stable clustering. However, in general you might need to apply steps 1 and 2 many times before getting your final clusters (and we'll see examples of this later on).</p>
<h2>What's Next?</h2>
<p>You may have noticed a problem with the description of K-means clustering given above: To perform step 1, we need to already have cluster labels. We can get labels from step 2, but only if we already have cluster centroids. Thus, before iterating these steps, we need to either initialize labels or initialize centroids.</p>
<p>There are various methods for initializing the labels or the centroids. The reason you might want to consider different initialization techniques is because, even though K-means is guaranteed to converge to a stable clustering, the clustering might not be optimal. That is, different initializations can lead to different outcomes. To avoid having to restart too many times, we want initialize in a clever way. In part 2 of this series, we'll discuss several initialization methods and discuss the importance of multiple random initializations in more detail.</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is a slight modification of the notmyidea theme by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>